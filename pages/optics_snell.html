<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë„¬ì˜ ë²•ì¹™ ë° êµ´ì ˆ ì‹œë®¬ë ˆì´ì…˜</title>
    
    <!-- MathJax ë¡œë“œ (ì´ë¡  ì„¤ëª… ìˆ˜ì‹ ë Œë”ë§ìš©) -->
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #f59e0b;
            --bg-color: #f8fafc;
            --panel-bg: #ffffff;
            --text-color: #334155;
            --border-color: #e2e8f0;
            --ray-incident: #ef4444; /* ì…ì‚¬ê´‘/ë°˜ì‚¬ê´‘ ìƒ‰ìƒ */
            --ray-refract: #3b82f6; /* êµ´ì ˆê´‘ ìƒ‰ìƒ */
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--panel-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 { margin: 0; font-size: 1.6rem; color: #0f172a; }
        .desc { font-size: 0.95rem; color: #64748b; margin-top: 8px; }

        /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tab-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: #ffffff;
            color: #64748b;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-btn:hover { background: #f1f5f9; }
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }

        .view-section { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ì‹œë®¬ë ˆì´ì…˜ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        canvas {
            width: 100%;
            background: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: block;
        }

        #simCanvas { height: 350px; }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 12px;
        }

        .result-box {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 8px;
            display: block;
        }

        .result-val { font-size: 1.4rem; font-weight: 800; color: #0f172a; }
        .result-sub { font-size: 0.85rem; color: #64748b; margin-top: 8px; line-height: 1.4; }

        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .control-panel {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            padding: 16px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group { display: flex; flex-direction: column; gap: 8px; }

        label {
            font-size: 0.85rem;
            font-weight: 700;
            color: #475569;
            display: flex;
            justify-content: space-between;
        }

        select, input[type="number"] {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 0.95rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        input[type="range"] { width: 100%; cursor: pointer; }
        
        .badge-1 { color: #0ea5e9; font-weight: bold; } /* ë§¤ì§ˆ 1 */
        .badge-2 { color: #8b5cf6; font-weight: bold; } /* ë§¤ì§ˆ 2 */

        /* ì´ë¡  ì„¤ëª… ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .theory-box {
            background: #eff6ff;
            padding: 24px;
            border-radius: 12px;
            border-left: 5px solid var(--primary-color);
            margin-bottom: 20px;
        }
        .theory-title { color: #1e40af; margin-top: 0; font-size: 1.2rem; }
        .theory-content { font-size: 1rem; color: #334155; line-height: 1.6; }
        .math-expr {
            font-size: 1.2rem;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #bfdbfe;
            overflow-x: auto;
        }
        .coeff-box {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .coeff-list { margin-top: 10px; padding-left: 20px; }
        .coeff-list li { margin-bottom: 8px; color: #475569; line-height: 1.5; }
        .coeff-list strong { color: #0f172a; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>âœ¨ ìŠ¤ë„¬ì˜ ë²•ì¹™ (êµ´ì ˆ ë²•ì¹™)</h1>
    </header>

    <div class="tab-group">
        <button class="tab-btn" id="btnTheory" onclick="switchTab('theory')">ğŸ“– ì´ë¡  ë° ê³µì‹</button>
        <button class="tab-btn active" id="btnSim" onclick="switchTab('sim')">ğŸ¯ ì‹œë®¬ë ˆì´ì…˜</button>
    </div>

    <!-- 1. ì´ë¡  ì„¤ëª… í™”ë©´ -->
    <div id="viewTheory" class="view-section">
        <div class="theory-box">
            <h3 class="theory-title">ìŠ¤ë„¬ì˜ ë²•ì¹™ (Snell's Law)</h3>
            <div class="theory-content">
                íŒŒë™ì´ í•œ ë§¤ì§ˆì—ì„œ ë‹¤ë¥¸ ë§¤ì§ˆë¡œ ì§„í–‰í•  ë•Œ, ë§¤ì§ˆì˜ ê²½ê³„ë©´ì—ì„œ ì§„í–‰ ë°©í–¥ì´ êº¾ì´ëŠ” í˜„ìƒì„ <b>êµ´ì ˆ(Refraction)</b>ì´ë¼ê³  í•©ë‹ˆë‹¤. ìŠ¤ë„¬ì˜ ë²•ì¹™ì€ ì…ì‚¬ê°ê³¼ êµ´ì ˆê°, ê·¸ë¦¬ê³  ë‘ ë§¤ì§ˆì˜ êµ´ì ˆë¥  ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
                <div class="math-expr">
                    $n_1 \sin \theta_1 = n_2 \sin \theta_2$
                </div>
                <ul>
                    <li>$n_1, n_2$: ë§¤ì§ˆ 1ê³¼ ë§¤ì§ˆ 2ì˜ ì ˆëŒ€ êµ´ì ˆë¥  (ì§„ê³µì—ì„œì˜ ë¹›ì˜ ì†ë ¥ê³¼ í•´ë‹¹ ë§¤ì§ˆì—ì„œì˜ ë¹›ì˜ ì†ë ¥ì˜ ë¹„, $n = c/v$)</li>
                    <li>$\theta_1$: ì…ì‚¬ê° (ê²½ê³„ë©´ì˜ ë²•ì„ ê³¼ ì…ì‚¬ê´‘ì´ ì´ë£¨ëŠ” ê°)</li>
                    <li>$\theta_2$: êµ´ì ˆê° (ê²½ê³„ë©´ì˜ ë²•ì„ ê³¼ êµ´ì ˆê´‘ì´ ì´ë£¨ëŠ” ê°)</li>
                </ul>
            </div>
        </div>

        <div class="coeff-box">
            <h3 style="margin-top: 0; color: #1e293b;">í˜ë¥´ë§ˆì˜ ì›ë¦¬ì— ì˜í•œ ìœ ë„ (ìµœë‹¨ ì‹œê°„ì˜ ì›ë¦¬)</h3>
            <div class="theory-content">
                ë¹›ì€ ë‘ ì  ì‚¬ì´ë¥¼ ì§„í–‰í•  ë•Œ <b>ê°€ì¥ ì‹œê°„ì´ ì ê²Œ ê±¸ë¦¬ëŠ” ê²½ë¡œ</b>ë¥¼ íƒí•œë‹¤ëŠ” í˜ë¥´ë§ˆì˜ ì›ë¦¬(Fermat's principle)ë¥¼ í†µí•´ ìŠ¤ë„¬ì˜ ë²•ì¹™ì„ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                <br><br>
                ì  A(ë§¤ì§ˆ 1)ì—ì„œ ì  B(ë§¤ì§ˆ 2)ë¡œ ë¹›ì´ ì§„í–‰í•  ë•Œ ê±¸ë¦¬ëŠ” ì´ ì‹œê°„ $t$ëŠ” ê° ë§¤ì§ˆì—ì„œì˜ ê²½ë¡œ ê¸¸ì´ë¥¼ ì†ë ¥ìœ¼ë¡œ ë‚˜ëˆˆ ê°’ì˜ í•©ì…ë‹ˆë‹¤.
                <div class="math-expr" style="border-color: #e2e8f0; font-size: 1.1rem;">
                    $t = \frac{\sqrt{x^2 + y_1^2}}{v_1} + \frac{\sqrt{(d-x)^2 + y_2^2}}{v_2}$
                </div>
                ì´ ì‹œê°„ì´ ìµœì†Œê°€ ë˜ê¸° ìœ„í•´ì„œëŠ” $t$ë¥¼ $x$ì— ëŒ€í•´ ë¯¸ë¶„í•œ ê°’ì´ 0ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ($\frac{dt}{dx} = 0$)
                <div class="math-expr" style="border-color: #e2e8f0; font-size: 1.1rem;">
                    $\frac{x}{v_1 \sqrt{x^2 + y_1^2}} - \frac{d-x}{v_2 \sqrt{(d-x)^2 + y_2^2}} = 0$
                </div>
                ê¸°í•˜í•™ì ìœ¼ë¡œ $\frac{x}{\sqrt{x^2 + y_1^2}} = \sin\theta_1$ ì´ê³ , $\frac{d-x}{\sqrt{(d-x)^2 + y_2^2}} = \sin\theta_2$ ì´ë¯€ë¡œ ì‹ì€ ë‹¤ìŒê³¼ ê°™ì´ ì •ë¦¬ë©ë‹ˆë‹¤.
                <div class="math-expr" style="border-color: #e2e8f0; font-size: 1.1rem;">
                    $\frac{\sin\theta_1}{v_1} = \frac{\sin\theta_2}{v_2}$
                </div>
                $n = \frac{c}{v}$ ê´€ê³„ë¥¼ ëŒ€ì…í•˜ë©´ $n_1 \sin\theta_1 = n_2 \sin\theta_2$ ê°€ ë„ì¶œë©ë‹ˆë‹¤.
            </div>
        </div>

        <div class="coeff-box" style="margin-top: 20px;">
            <h3 style="margin-top: 0; color: #ef4444;">ì „ë°˜ì‚¬ (Total Internal Reflection)</h3>
            <div class="theory-content">
                ë¹›ì´ êµ´ì ˆë¥ ì´ í° ë§¤ì§ˆì—ì„œ ì‘ì€ ë§¤ì§ˆë¡œ ì§„í–‰í•  ë•Œ ($n_1 > n_2$), êµ´ì ˆê°ì´ $90^\circ$ê°€ ë  ë•Œì˜ ì…ì‚¬ê°ì„ <b>ì„ê³„ê°($\theta_c$)</b>ì´ë¼ê³  í•©ë‹ˆë‹¤. ì…ì‚¬ê°ì´ ì„ê³„ê°ë³´ë‹¤ ì»¤ì§€ë©´ ë¹›ì€ ë§¤ì§ˆ 2ë¡œ íˆ¬ê³¼í•˜ì§€ ëª»í•˜ê³  ê²½ê³„ë©´ì—ì„œ 100% ë°˜ì‚¬ë©ë‹ˆë‹¤.
                <div class="math-expr" style="border-color: #fca5a5; background-color: #fef2f2;">
                    $\theta_c = \sin^{-1} \left( \frac{n_2}{n_1} \right)$
                </div>
            </div>
        </div>
    </div>

    <!-- 2. ì‹œë®¬ë ˆì´ì…˜ í™”ë©´ -->
    <div id="viewSim" class="view-section active">
        <canvas id="simCanvas" width="800" height="350"></canvas>

        <div class="dashboard">
            <div class="result-box">
                <span class="result-title">ì…ì‚¬ê° ($\theta_1$)</span>
                <div class="result-val" id="dispTheta1" style="color: var(--ray-incident);">0.0Â°</div>
                <div class="result-sub" id="dispN1">ë§¤ì§ˆ 1: n = 1.00</div>
            </div>
            <div class="result-box">
                <span class="result-title">êµ´ì ˆê° ($\theta_2$)</span>
                <div class="result-val" id="dispTheta2" style="color: var(--ray-refract);">0.0Â°</div>
                <div class="result-sub" id="dispN2">ë§¤ì§ˆ 2: n = 1.33</div>
            </div>
            <div class="result-box">
                <span class="result-title">ìƒíƒœ / ì„ê³„ê°</span>
                <div class="result-val" id="dispStatus" style="color: #10b981; font-size: 1.2rem;">ì •ìƒ êµ´ì ˆ</div>
                <div class="result-sub" id="dispCritical">ì„ê³„ê°: ì—†ìŒ</div>
            </div>
        </div>

        <div class="controls">
            <!-- ë§¤ì§ˆ 1 ì»¨íŠ¸ë¡¤ -->
            <div class="control-panel" style="border-top: 4px solid #0ea5e9;">
                <label><span class="badge-1">ìœ„ìª½ ë§¤ì§ˆ (ë§¤ì§ˆ 1)</span></label>
                <div class="control-group">
                    <select id="preset1" onchange="applyPreset(1)">
                        <option value="1.00">ê³µê¸° / ì§„ê³µ (1.00)</option>
                        <option value="1.33">ë¬¼ (1.33)</option>
                        <option value="1.36">ì—íƒ„ì˜¬ (1.36)</option>
                        <option value="1.52">í¬ë¼ìš´ ìœ ë¦¬ (1.52)</option>
                        <option value="1.62">í”Œë¦°íŠ¸ ìœ ë¦¬ (1.62)</option>
                        <option value="1.77">ì‚¬íŒŒì´ì–´ (1.77)</option>
                        <option value="2.42">ë‹¤ì´ì•„ëª¬ë“œ (2.42)</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥...</option>
                    </select>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size:0.9rem; font-weight:bold;">$n_1$ =</span>
                        <input type="number" id="inN1" min="1.0" max="4.0" step="0.01" value="1.00" oninput="updateFromInput(1)">
                    </div>
                </div>
            </div>

            <!-- ë§¤ì§ˆ 2 ì»¨íŠ¸ë¡¤ -->
            <div class="control-panel" style="border-top: 4px solid #8b5cf6;">
                <label><span class="badge-2">ì•„ë˜ìª½ ë§¤ì§ˆ (ë§¤ì§ˆ 2)</span></label>
                <div class="control-group">
                    <select id="preset2" onchange="applyPreset(2)">
                        <option value="1.00">ê³µê¸° / ì§„ê³µ (1.00)</option>
                        <option value="1.33" selected>ë¬¼ (1.33)</option>
                        <option value="1.36">ì—íƒ„ì˜¬ (1.36)</option>
                        <option value="1.52">í¬ë¼ìš´ ìœ ë¦¬ (1.52)</option>
                        <option value="1.62">í”Œë¦°íŠ¸ ìœ ë¦¬ (1.62)</option>
                        <option value="1.77">ì‚¬íŒŒì´ì–´ (1.77)</option>
                        <option value="2.42">ë‹¤ì´ì•„ëª¬ë“œ (2.42)</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥...</option>
                    </select>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size:0.9rem; font-weight:bold;">$n_2$ =</span>
                        <input type="number" id="inN2" min="1.0" max="4.0" step="0.01" value="1.33" oninput="updateFromInput(2)">
                    </div>
                </div>
            </div>
            
            <!-- ì…ì‚¬ê° ì¡°ì ˆ ìŠ¬ë¼ì´ë” -->
            <div class="control-panel" style="grid-column: 1 / -1; border-top: 4px solid var(--text-color);">
                <div class="control-group">
                    <label><span>ë ˆì´ì € ì…ì‚¬ê° ($\theta_1$)</span> <span id="valTheta1">45.0Â°</span></label>
                    <input type="range" id="inTheta1" min="0" max="89.9" step="0.1" value="45.0" oninput="calculateAndDraw()">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- íƒ­ ì „í™˜ ë¡œì§ ---
    function switchTab(tabId) {
        const btnTheory = document.getElementById('btnTheory');
        const btnSim = document.getElementById('btnSim');
        const viewTheory = document.getElementById('viewTheory');
        const viewSim = document.getElementById('viewSim');

        if (tabId === 'theory') {
            btnTheory.classList.add('active');
            btnSim.classList.remove('active');
            viewTheory.classList.add('active');
            viewSim.classList.remove('active');
        } else {
            btnSim.classList.add('active');
            btnTheory.classList.remove('active');
            viewSim.classList.add('active');
            viewTheory.classList.remove('active');
            calculateAndDraw(); // ìº”ë²„ìŠ¤ ë³µêµ¬
        }
    }

    // --- ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ---
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    // DOM ìš”ì†Œ
    const inN1 = document.getElementById('inN1');
    const inN2 = document.getElementById('inN2');
    const preset1 = document.getElementById('preset1');
    const preset2 = document.getElementById('preset2');
    const inTheta1 = document.getElementById('inTheta1');
    
    const dispTheta1 = document.getElementById('dispTheta1');
    const dispTheta2 = document.getElementById('dispTheta2');
    const dispN1 = document.getElementById('dispN1');
    const dispN2 = document.getElementById('dispN2');
    const dispStatus = document.getElementById('dispStatus');
    const dispCritical = document.getElementById('dispCritical');
    const valTheta1 = document.getElementById('valTheta1');

    // í”„ë¦¬ì…‹ ë³€ê²½ ì‹œ ì…ë ¥ì°½ ì—…ë°ì´íŠ¸
    function applyPreset(mediumNum) {
        const presetObj = mediumNum === 1 ? preset1 : preset2;
        const inputObj = mediumNum === 1 ? inN1 : inN2;
        
        if (presetObj.value !== 'custom') {
            inputObj.value = presetObj.value;
        }
        calculateAndDraw();
    }

    // ì…ë ¥ì°½ ì§ì ‘ ìˆ˜ì • ì‹œ í”„ë¦¬ì…‹ì„ 'custom'ìœ¼ë¡œ ë³€ê²½
    function updateFromInput(mediumNum) {
        const presetObj = mediumNum === 1 ? preset1 : preset2;
        const inputObj = mediumNum === 1 ? inN1 : inN2;
        const val = parseFloat(inputObj.value).toFixed(2);
        
        let found = false;
        for (let i = 0; i < presetObj.options.length; i++) {
            if (presetObj.options[i].value === val) {
                presetObj.selectedIndex = i;
                found = true;
                break;
            }
        }
        if (!found) presetObj.value = 'custom';
        
        calculateAndDraw();
    }

    // ë°°ê²½ìƒ‰ ê³„ì‚° í•¨ìˆ˜ (êµ´ì ˆë¥ ì´ ë†’ì„ìˆ˜ë¡ ì•½ê°„ ë” ì–´ë‘¡ê³  í‘¸ë¥¸/ë³´ë¼ë¹›)
    function getMediumColor(n, isTop) {
        // ê³µê¸°(1.0)ì¼ë•Œ ì™„ì „ í°ìƒ‰ì— ê°€ê¹ê²Œ, ë‹¤ì´ì•„(2.4)ì¼ë•Œ ìƒ‰ìƒ ë¶€ì—¬
        const normalized = Math.min(Math.max((n - 1.0) / 1.5, 0), 1);
        if (isTop) {
            // ìœ„ìª½ì€ ì•½ê°„ í‘¸ë¥¸ë¹› ë°”íƒ•
            const r = Math.floor(255 - normalized * 40);
            const g = Math.floor(255 - normalized * 20);
            const b = 255;
            return `rgb(${r}, ${g}, ${b})`;
        } else {
            // ì•„ë˜ìª½ì€ ì•½ê°„ ë³´ë¼ë¹› ë°”íƒ•
            const r = Math.floor(255 - normalized * 30);
            const g = Math.floor(255 - normalized * 40);
            const b = 255;
            return `rgb(${r}, ${g}, ${b})`;
        }
    }

    // ë©”ì¸ ë¬¼ë¦¬ ì—°ì‚° ë° ê·¸ë¦¬ê¸° í•¨ìˆ˜
    function calculateAndDraw() {
        const n1 = parseFloat(inN1.value);
        const n2 = parseFloat(inN2.value);
        const theta1_deg = parseFloat(inTheta1.value);
        const theta1_rad = theta1_deg * Math.PI / 180;

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ (ë§¤ì§ˆ)
        dispN1.innerText = `ë§¤ì§ˆ 1: n = ${n1.toFixed(2)}`;
        dispN2.innerText = `ë§¤ì§ˆ 2: n = ${n2.toFixed(2)}`;
        valTheta1.innerText = `${theta1_deg.toFixed(1)}Â°`;

        let theta2_rad = 0;
        let theta2_deg = 0;
        let isTIR = false;
        let criticalAngle_deg = null;

        // ìŠ¤ë„¬ì˜ ë²•ì¹™ ì—°ì‚°
        const sinTheta2 = (n1 / n2) * Math.sin(theta1_rad);

        // ì„ê³„ê° ê³„ì‚° (n1 > n2 ì¸ ê²½ìš°ë§Œ ì¡´ì¬)
        if (n1 > n2) {
            criticalAngle_deg = Math.asin(n2 / n1) * 180 / Math.PI;
            dispCritical.innerText = `ì„ê³„ê°: ${criticalAngle_deg.toFixed(1)}Â°`;
            
            if (sinTheta2 > 1.0) {
                isTIR = true; // ì „ë°˜ì‚¬ ë°œìƒ
            } else {
                theta2_rad = Math.asin(sinTheta2);
                theta2_deg = theta2_rad * 180 / Math.PI;
            }
        } else {
            dispCritical.innerText = "ì„ê³„ê°: ì—†ìŒ (nâ‚ â‰¤ nâ‚‚)";
            theta2_rad = Math.asin(sinTheta2);
            theta2_deg = theta2_rad * 180 / Math.PI;
        }

        // ëŒ€ì‹œë³´ë“œ ìƒíƒœ ì—…ë°ì´íŠ¸
        dispTheta1.innerText = `${theta1_deg.toFixed(1)}Â°`;
        if (isTIR) {
            dispTheta2.innerText = "ì—†ìŒ";
            dispStatus.innerText = "ì „ë°˜ì‚¬ ë°œìƒ!";
            dispStatus.style.color = "#ef4444";
        } else {
            dispTheta2.innerText = `${theta2_deg.toFixed(1)}Â°`;
            dispStatus.innerText = "ì •ìƒ êµ´ì ˆ";
            dispStatus.style.color = "#10b981";
        }

        // --- ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° ---
        const cw = canvas.width;
        const ch = canvas.height;
        const cx = cw / 2;
        const cy = ch / 2;
        const rayLength = 400; // ì¶©ë¶„íˆ ê¸´ ê¸¸ì´

        ctx.clearRect(0, 0, cw, ch);

        // 1. ë§¤ì§ˆ ë°°ê²½ìƒ‰ ì¹ í•˜ê¸°
        ctx.fillStyle = getMediumColor(n1, true);
        ctx.fillRect(0, 0, cw, cy);
        ctx.fillStyle = getMediumColor(n2, false);
        ctx.fillRect(0, cy, cw, ch);

        // 2. ê²½ê³„ë©´ ê·¸ë¦¬ê¸° (ê°€ë¡œì„ )
        ctx.strokeStyle = "#94a3b8";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, cy);
        ctx.lineTo(cw, cy);
        ctx.stroke();

        // 3. ë²•ì„  ê·¸ë¦¬ê¸° (ì„¸ë¡œ ì ì„ )
        ctx.strokeStyle = "#cbd5e1";
        ctx.lineWidth = 2;
        ctx.setLineDash([8, 8]);
        ctx.beginPath();
        ctx.moveTo(cx, 0);
        ctx.lineTo(cx, ch);
        ctx.stroke();
        ctx.setLineDash([]);

        // 4. ì…ì‚¬ê´‘ ê·¸ë¦¬ê¸° (ë¹¨ê°„ìƒ‰)
        // ì…ì‚¬ê´‘ì€ ì™¼ìª½ ìœ„(-x, -y ë°©í–¥)ì—ì„œ ì¤‘ì•™(cx, cy)ìœ¼ë¡œ í–¥í•¨
        const incX = cx - rayLength * Math.sin(theta1_rad);
        const incY = cy - rayLength * Math.cos(theta1_rad);
        
        ctx.strokeStyle = "#ef4444";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(incX, incY);
        ctx.lineTo(cx, cy);
        ctx.stroke();

        // 5. êµ´ì ˆê´‘ & ë°˜ì‚¬ê´‘ ê·¸ë¦¬ê¸°
        if (isTIR) {
            // ì „ë°˜ì‚¬: êµ´ì ˆê´‘ ì—†ìŒ, ë°˜ì‚¬ê´‘ 100% ì§„í•˜ê²Œ
            const refX = cx + rayLength * Math.sin(theta1_rad);
            const refY = cy - rayLength * Math.cos(theta1_rad);
            
            ctx.strokeStyle = "#ef4444"; // ì…ì‚¬ê´‘ê³¼ ê°™ì€ ë°ê¸°
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(refX, refY);
            ctx.stroke();
        } else {
            // ì •ìƒ êµ´ì ˆ: êµ´ì ˆê´‘(íŒŒë€ìƒ‰) + ì•½í•œ ë°˜ì‚¬ê´‘(íë¦° ë¹¨ê°„ìƒ‰)
            
            // êµ´ì ˆê´‘
            const refrX = cx + rayLength * Math.sin(theta2_rad);
            const refrY = cy + rayLength * Math.cos(theta2_rad);
            ctx.strokeStyle = "#3b82f6";
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(refrX, refrY);
            ctx.stroke();

            // ì•½í•œ ë°˜ì‚¬ê´‘ (í˜„ì‹¤ì„± ë¶€ì—¬)
            const refX = cx + rayLength * Math.sin(theta1_rad);
            const refY = cy - rayLength * Math.cos(theta1_rad);
            ctx.strokeStyle = "rgba(239, 68, 68, 0.25)"; // íë¦¬ê²Œ
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(refX, refY);
            ctx.stroke();

            // êµ´ì ˆê° í˜¸(Arc) ê·¸ë¦¬ê¸°
            ctx.strokeStyle = "#3b82f6";
            ctx.lineWidth = 2;
            ctx.beginPath();
            // ë²•ì„  ì•„ë˜ìª½(Math.PI/2)ì—ì„œë¶€í„° êµ´ì ˆê°ë§Œí¼
            ctx.arc(cx, cy, 50, Math.PI/2 - theta2_rad, Math.PI/2);
            ctx.stroke();
        }

        // 6. ì…ì‚¬ê° í˜¸(Arc) ê·¸ë¦¬ê¸°
        ctx.strokeStyle = "#ef4444";
        ctx.lineWidth = 2;
        ctx.beginPath();
        // ë²•ì„  ìœ„ìª½(-Math.PI/2)ì—ì„œë¶€í„° ì…ì‚¬ê°ë§Œí¼ ì™¼ìª½ìœ¼ë¡œ
        ctx.arc(cx, cy, 40, -Math.PI/2, -Math.PI/2 + theta1_rad);
        ctx.stroke();
    }

    // ì´ˆê¸° ì‹¤í–‰
    calculateAndDraw();

</script>

</body>
</html>
