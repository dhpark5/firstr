<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ë™ëŸ‰ ë³´ì¡´ ë²•ì¹™ ì‹œë®¬ë ˆì´ì…˜</title>
    
    <!-- MathJax ë¡œë“œ (ì´ë¡  ì„¤ëª… ìˆ˜ì‹ ë Œë”ë§ìš©) -->
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

    <style>
        :root {
            --primary-color: #3b82f6; /* ë¬¼ì²´ 1 ìƒ‰ìƒ */
            --secondary-color: #ef4444; /* ë¬¼ì²´ 2 ìƒ‰ìƒ */
            --bg-color: #f8fafc;
            --panel-bg: #ffffff;
            --text-color: #334155;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--panel-bg);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 { margin: 0; font-size: 1.6rem; color: #0f172a; }
        .desc { font-size: 0.95rem; color: #64748b; margin-top: 8px; }

        /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tab-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: #ffffff;
            color: #64748b;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-btn:hover { background: #f1f5f9; }
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }

        .view-section { display: none; width: 100%; animation: fadeIn 0.3s ease-in-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ì‹œë®¬ë ˆì´ì…˜ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        canvas {
            width: 100%;
            background: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: block;
        }

        #simCanvas { height: 250px; }
        #graphCanvas { height: 200px; margin-top: 15px; }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 12px;
        }

        .result-box {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 8px;
            display: block;
        }

        .result-val { font-size: 1.4rem; font-weight: 800; color: #0f172a; }
        .result-sub { font-size: 0.85rem; color: #64748b; margin-top: 8px; line-height: 1.4; }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        button.sim-ctrl-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-play { background: #10b981; color: white; }
        .btn-play:hover { background: #059669; }
        .btn-reset { background: #e2e8f0; color: #475569; }
        .btn-reset:hover { background: #cbd5e1; }

        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .control-panel {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            padding: 16px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-group { display: flex; flex-direction: column; gap: 5px; }

        label {
            font-size: 0.85rem;
            font-weight: 700;
            color: #475569;
            display: flex;
            justify-content: space-between;
        }

        input[type="range"] { width: 100%; cursor: pointer; }
        
        .badge-1 { color: var(--primary-color); font-weight: bold; }
        .badge-2 { color: var(--secondary-color); font-weight: bold; }
        .badge-sys { color: #8b5cf6; font-weight: bold; }

        /* ì´ë¡  ì„¤ëª… ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .theory-box {
            background: #eff6ff;
            padding: 24px;
            border-radius: 12px;
            border-left: 5px solid var(--primary-color);
            margin-bottom: 20px;
        }
        .theory-title { color: #1e40af; margin-top: 0; font-size: 1.2rem; }
        .theory-content { font-size: 1rem; color: #334155; line-height: 1.6; }
        .math-expr {
            font-size: 1.2rem;
            text-align: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #bfdbfe;
        }
        .coeff-box {
            background: #f8fafc;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .coeff-list { margin-top: 10px; padding-left: 20px; }
        .coeff-list li { margin-bottom: 8px; color: #475569; line-height: 1.5; }
        .coeff-list strong { color: #0f172a; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ’¥ 1ì°¨ì› ìš´ë™ëŸ‰ ë³´ì¡´ ë²•ì¹™</h1>
    </header>

    <!-- íƒ­ ë‚´ë¹„ê²Œì´ì…˜ -->
    <div class="tab-group">
        <button class="tab-btn" id="btnTheory" onclick="switchTab('theory')">ğŸ“– ì´ë¡  ì„¤ëª…</button>
        <button class="tab-btn active" id="btnSim" onclick="switchTab('sim')">ğŸ¯ ì‹œë®¬ë ˆì´ì…˜</button>
    </div>

    <!-- 1. ì´ë¡  ì„¤ëª… í™”ë©´ -->
    <div id="viewTheory" class="view-section">
        <div class="theory-box">
            <h3 class="theory-title">ìš´ë™ëŸ‰ ë³´ì¡´ ë²•ì¹™ (Law of Conservation of Momentum)</h3>
            <div class="theory-content">
                ë¬¼ë¦¬ê³„(System)ì— ì™¸ë¶€ì—ì„œ ì•Œì§œí˜(Net external force)ì´ ì‘ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ê³„ë¥¼ êµ¬ì„±í•˜ëŠ” ë¬¼ì²´ë“¤ ì‚¬ì´ì— ìƒí˜¸ì‘ìš©(ì¶©ëŒ ë“±)ì´ ì¼ì–´ë‚˜ë”ë¼ë„ <b>ê³„ì˜ ì´ ìš´ë™ëŸ‰ì€ í•­ìƒ ì¼ì •í•˜ê²Œ ìœ ì§€</b>ë©ë‹ˆë‹¤.
                <div class="math-expr">
                    $\sum \vec{p}_{\text{ì´ˆê¸°}} = \sum \vec{p}_{\text{ë‚˜ì¤‘}}$ <br><br>
                    $m_1 u_1 + m_2 u_2 = m_1 v_1 + m_2 v_2$
                </div>
                ì—¬ê¸°ì„œ $m$ì€ ì§ˆëŸ‰, $u$ëŠ” ì¶©ëŒ ì „ ì´ˆê¸° ì†ë„, $v$ëŠ” ì¶©ëŒ í›„ ì†ë„ì…ë‹ˆë‹¤.
            </div>
        </div>

        <div class="coeff-box">
            <h3 style="margin-top: 0; color: #1e293b;">ì¶©ëŒì˜ ì¢…ë¥˜ì™€ ë°˜ë°œ ê³„ìˆ˜ ($e$)</h3>
            <div class="theory-content">
                ë‘ ë¬¼ì²´ê°€ ì¶©ëŒí•  ë•Œ, ê°€ê¹Œì›Œì§€ëŠ” ìƒëŒ€ ì†ë„ì˜ í¬ê¸°ì™€ ë©€ì–´ì§€ëŠ” ìƒëŒ€ ì†ë„ì˜ í¬ê¸°ì˜ ë¹„ë¥¼ <b>ë°˜ë°œ ê³„ìˆ˜(Coefficient of Restitution)</b>ë¼ê³  í•©ë‹ˆë‹¤.
                <div class="math-expr" style="border-color: #e2e8f0;">
                    $e = - \frac{v_2 - v_1}{u_2 - u_1}$
                </div>
                ë°˜ë°œ ê³„ìˆ˜ì˜ ê°’ì— ë”°ë¼ ì¶©ëŒì„ ë‹¤ìŒê³¼ ê°™ì´ ë¶„ë¥˜í•©ë‹ˆë‹¤:
                <ul class="coeff-list">
                    <li><strong>ì™„ì „ íƒ„ì„± ì¶©ëŒ ($e = 1$):</strong> ì¶©ëŒ ê³¼ì •ì—ì„œ ì—­í•™ì  ì—ë„ˆì§€(ìš´ë™ ì—ë„ˆì§€)ê°€ 100% ë³´ì¡´ë˜ëŠ” ì´ìƒì ì¸ ì¶©ëŒì…ë‹ˆë‹¤. (ì˜ˆ: ì´ìƒê¸°ì²´ ë¶„ìì˜ ì¶©ëŒ)</li>
                    <li><strong>ë¹„íƒ„ì„± ì¶©ëŒ ($0 < e < 1$):</strong> ìš´ë™ëŸ‰ì€ ë³´ì¡´ë˜ì§€ë§Œ, ìš´ë™ ì—ë„ˆì§€ì˜ ì¼ë¶€ê°€ ì—´ì—ë„ˆì§€ë‚˜ ì†Œë¦¬ ë“±ìœ¼ë¡œ ì „í™˜ë˜ì–´ ì†ì‹¤ë©ë‹ˆë‹¤. ì¼ìƒìƒí™œì—ì„œ ê´€ì°°ë˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì¶©ëŒì…ë‹ˆë‹¤.</li>
                    <li><strong>ì™„ì „ ë¹„íƒ„ì„± ì¶©ëŒ ($e = 0$):</strong> ì¶©ëŒ í›„ ë‘ ë¬¼ì²´ê°€ í•œ ë©ì–´ë¦¬ê°€ ë˜ì–´ ê°™ì€ ì†ë„ë¡œ ìš´ë™í•©ë‹ˆë‹¤. ìš´ë™ ì—ë„ˆì§€ ì†ì‹¤ì´ ê°€ì¥ í° í˜•íƒœì˜ ì¶©ëŒì…ë‹ˆë‹¤.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 2. ì‹œë®¬ë ˆì´ì…˜ í™”ë©´ -->
    <div id="viewSim" class="view-section active">
        <!-- ì‹œë®¬ë ˆì´ì…˜ ì˜ì—­ -->
        <canvas id="simCanvas" width="800" height="250"></canvas>
        
        <!-- ì‹¤ì‹œê°„ ì†ë„ ê·¸ë˜í”„ ì˜ì—­ -->
        <canvas id="graphCanvas" width="800" height="200"></canvas>

        <div class="btn-group">
            <button class="sim-ctrl-btn btn-play" id="btnPlay" onclick="togglePlay()">ì‹œì‘ (Play)</button>
            <button class="sim-ctrl-btn btn-reset" onclick="resetSim()">ì´ˆê¸°í™” (Reset)</button>
        </div>

        <div class="dashboard">
            <div class="result-box">
                <span class="result-title">ë¬¼ì²´ 1 (mâ‚)</span>
                <div class="result-val" id="dispP1" style="color: var(--primary-color);">0 kgÂ·m/s</div>
                <div class="result-sub" id="dispV1">vâ‚ = 0 m/s</div>
            </div>
            <div class="result-box">
                <span class="result-title">ë¬¼ì²´ 2 (mâ‚‚)</span>
                <div class="result-val" id="dispP2" style="color: var(--secondary-color);">0 kgÂ·m/s</div>
                <div class="result-sub" id="dispV2">vâ‚‚ = 0 m/s</div>
            </div>
            <div class="result-box">
                <span class="result-title">ê³„ì˜ ì´ ìš´ë™ëŸ‰ (Î£p)</span>
                <div class="result-val" id="dispPtotal" style="color: #8b5cf6;">0 kgÂ·m/s</div>
                <div class="result-sub" id="dispStatus" style="font-weight:bold;">ì¶©ëŒ ì „ (í•­ìƒ ì¼ì •)</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-panel" style="border-top: 4px solid var(--primary-color);">
                <div class="control-group">
                    <label><span class="badge-1">ë¬¼ì²´ 1 ì§ˆëŸ‰ (mâ‚)</span> <span id="valM1">1.0 kg</span></label>
                    <input type="range" id="inM1" min="0.5" max="5.0" step="0.1" value="1.0" oninput="updateSettings()">
                </div>
                <div class="control-group">
                    <label><span class="badge-1">ë¬¼ì²´ 1 ì´ˆê¸° ì†ë„ (uâ‚)</span> <span id="valU1">4.0 m/s</span></label>
                    <input type="range" id="inU1" min="-10" max="10" step="0.1" value="4.0" oninput="updateSettings()">
                </div>
            </div>

            <div class="control-panel" style="border-top: 4px solid var(--secondary-color);">
                <div class="control-group">
                    <label><span class="badge-2">ë¬¼ì²´ 2 ì§ˆëŸ‰ (mâ‚‚)</span> <span id="valM2">2.0 kg</span></label>
                    <input type="range" id="inM2" min="0.5" max="5.0" step="0.1" value="2.0" oninput="updateSettings()">
                </div>
                <div class="control-group">
                    <label><span class="badge-2">ë¬¼ì²´ 2 ì´ˆê¸° ì†ë„ (uâ‚‚)</span> <span id="valU2">-2.0 m/s</span></label>
                    <input type="range" id="inU2" min="-10" max="10" step="0.1" value="-2.0" oninput="updateSettings()">
                </div>
            </div>
            
            <div class="control-panel" style="grid-column: 1 / -1; border-top: 4px solid #8b5cf6;">
                <div class="control-group">
                    <label><span class="badge-sys">ë°˜ë°œ ê³„ìˆ˜ (e)</span> <span id="valE">1.00 (ì™„ì „ íƒ„ì„± ì¶©ëŒ)</span></label>
                    <input type="range" id="inE" min="0" max="1" step="0.01" value="1.0" oninput="updateSettings()">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- íƒ­ ì „í™˜ ë¡œì§ ---
    function switchTab(tabId) {
        const btnTheory = document.getElementById('btnTheory');
        const btnSim = document.getElementById('btnSim');
        const viewTheory = document.getElementById('viewTheory');
        const viewSim = document.getElementById('viewSim');

        if (tabId === 'theory') {
            btnTheory.classList.add('active');
            btnSim.classList.remove('active');
            viewTheory.classList.add('active');
            viewSim.classList.remove('active');
        } else {
            btnSim.classList.add('active');
            btnTheory.classList.remove('active');
            viewSim.classList.add('active');
            viewTheory.classList.remove('active');
            
            // ì‹œë®¬ë ˆì´ì…˜ íƒ­ìœ¼ë¡œ ëŒì•„ì™”ì„ ë•Œ ìº”ë²„ìŠ¤ ë¦¬ë Œë”ë§ (ê¹¨ì§ ë°©ì§€)
            if (!isPlaying) {
                drawSim();
                drawGraph();
            }
        }
    }

    // --- ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ---
    const simCanvas = document.getElementById('simCanvas');
    const simCtx = simCanvas.getContext('2d');
    const graphCanvas = document.getElementById('graphCanvas');
    const graphCtx = graphCanvas.getContext('2d');
    
    let isPlaying = false;
    let hasCollided = false;
    let animationId;

    // ë¬¼ë¦¬ ë³€ìˆ˜
    let m1 = 1.0, m2 = 2.0;
    let u1 = 4.0, u2 = -2.0;
    let e = 1.0;
    
    // ê°ì²´ ìƒíƒœ (uëŠ” ì´ˆê¸°ì†ë„ ë³´ì¡´ìš©, vëŠ” í˜„ì¬ì†ë„)
    let obj1 = { x: 200, v: 4.0, u: 4.0, m: 1.0, r: 25, color: '#3b82f6' };
    let obj2 = { x: 600, v: -2.0, u: -2.0, m: 2.0, r: 35, color: '#ef4444' };

    // ê·¸ë˜í”„ ê¸°ë¡ìš©
    let simTime = 0;
    let historyData = [];

    // DOM ìš”ì†Œ
    const btnPlay = document.getElementById('btnPlay');
    const dispP1 = document.getElementById('dispP1');
    const dispP2 = document.getElementById('dispP2');
    const dispPtotal = document.getElementById('dispPtotal');
    const dispV1 = document.getElementById('dispV1');
    const dispV2 = document.getElementById('dispV2');
    const dispStatus = document.getElementById('dispStatus');

    function updateSettings() {
        if (isPlaying) return; 
        
        m1 = parseFloat(document.getElementById('inM1').value);
        u1 = parseFloat(document.getElementById('inU1').value);
        m2 = parseFloat(document.getElementById('inM2').value);
        u2 = parseFloat(document.getElementById('inU2').value);
        e = parseFloat(document.getElementById('inE').value);

        document.getElementById('valM1').innerText = m1.toFixed(1) + " kg";
        document.getElementById('valU1').innerText = u1.toFixed(1) + " m/s";
        document.getElementById('valM2').innerText = m2.toFixed(1) + " kg";
        document.getElementById('valU2').innerText = u2.toFixed(1) + " m/s";
        
        let eStr = e.toFixed(2);
        if (e === 1.0) eStr += " (ì™„ì „ íƒ„ì„± ì¶©ëŒ)";
        else if (e === 0.0) eStr += " (ì™„ì „ ë¹„íƒ„ì„± ì¶©ëŒ)";
        else eStr += " (ë¹„íƒ„ì„± ì¶©ëŒ)";
        document.getElementById('valE').innerText = eStr;

        resetSim();
    }

    function resetSim() {
        isPlaying = false;
        hasCollided = false;
        simTime = 0;
        historyData = [];

        btnPlay.innerText = "ì‹œì‘ (Play)";
        btnPlay.style.background = "#10b981";
        dispStatus.innerText = "ìƒíƒœ: ì¶©ëŒ ì „";
        dispStatus.style.color = "#64748b";
        
        obj1 = { x: 200, v: u1, u: u1, m: m1, r: 20 + m1 * 4, color: '#3b82f6' };
        obj2 = { x: 600, v: u2, u: u2, m: m2, r: 20 + m2 * 4, color: '#ef4444' };
        
        // ì´ˆê¸° ìƒíƒœ ê·¸ë˜í”„ì— ê¸°ë¡
        historyData.push({ t: simTime, v1: obj1.v, v2: obj2.v });

        cancelAnimationFrame(animationId);
        updateDashboard();
        drawSim();
        drawGraph();
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        if (isPlaying) {
            btnPlay.innerText = "ì¼ì‹œì •ì§€ (Pause)";
            btnPlay.style.background = "#f59e0b";
            loop();
        } else {
            btnPlay.innerText = "ê³„ì† (Resume)";
            btnPlay.style.background = "#10b981";
            cancelAnimationFrame(animationId);
        }
    }

    function updateDashboard() {
        // ì¶©ëŒ ì „ ìš´ë™ëŸ‰ ê³„ì‚°
        const p1_before = obj1.m * obj1.u;
        const p2_before = obj2.m * obj2.u;
        const pTotal_before = p1_before + p2_before;

        // í˜„ì¬(ì¶©ëŒ í›„) ìš´ë™ëŸ‰ ê³„ì‚°
        const p1_after = obj1.m * obj1.v;
        const p2_after = obj2.m * obj2.v;
        const pTotal_after = p1_after + p2_after;

        if (hasCollided) {
            dispP1.innerHTML = `<div style="font-size:0.85rem; color:#94a3b8; text-decoration:line-through; font-weight:normal;">ì „: ${p1_before.toFixed(1)} kgÂ·m/s</div><div style="font-size:1.1rem; margin-top:2px;">í›„: ${p1_after.toFixed(1)} kgÂ·m/s</div>`;
            dispP2.innerHTML = `<div style="font-size:0.85rem; color:#94a3b8; text-decoration:line-through; font-weight:normal;">ì „: ${p2_before.toFixed(1)} kgÂ·m/s</div><div style="font-size:1.1rem; margin-top:2px;">í›„: ${p2_after.toFixed(1)} kgÂ·m/s</div>`;
            dispPtotal.innerHTML = `<div style="font-size:0.85rem; color:#8b5cf6; font-weight:normal; opacity:0.8;">ì „: ${pTotal_before.toFixed(1)} kgÂ·m/s</div><div style="font-size:1.1rem; margin-top:2px;">í›„: ${pTotal_after.toFixed(1)} kgÂ·m/s</div>`;

            dispV1.innerHTML = `<span style="color:#94a3b8; text-decoration:line-through;">ì¶©ëŒ ì „: ${obj1.u.toFixed(2)} m/s</span><br><b style="color:var(--primary-color)">ì¶©ëŒ í›„: ${obj1.v.toFixed(2)} m/s</b>`;
            dispV2.innerHTML = `<span style="color:#94a3b8; text-decoration:line-through;">ì¶©ëŒ ì „: ${obj2.u.toFixed(2)} m/s</span><br><b style="color:var(--secondary-color)">ì¶©ëŒ í›„: ${obj2.v.toFixed(2)} m/s</b>`;
        } else {
            dispP1.innerHTML = `${p1_after.toFixed(1)} <span style="font-size:0.8rem; font-weight:normal;">kgÂ·m/s</span>`;
            dispP2.innerHTML = `${p2_after.toFixed(1)} <span style="font-size:0.8rem; font-weight:normal;">kgÂ·m/s</span>`;
            dispPtotal.innerHTML = `${pTotal_after.toFixed(1)} <span style="font-size:0.8rem; font-weight:normal;">kgÂ·m/s</span>`;

            dispV1.innerHTML = `í˜„ì¬ ì†ë„: <b>${obj1.v.toFixed(2)} m/s</b>`;
            dispV2.innerHTML = `í˜„ì¬ ì†ë„: <b>${obj2.v.toFixed(2)} m/s</b>`;
        }
    }

    function drawArrow(ctx, x, y, v, color, isDashed = false, label = "") {
        if (Math.abs(v) < 0.1) return;
        const scale = 12; 
        const length = Math.abs(v) * scale;
        const dir = v > 0 ? 1 : -1;
        const endX = x + dir * length;
        
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.lineWidth = isDashed ? 2 : 3;
        
        if (isDashed) ctx.setLineDash([4, 4]);
        else ctx.setLineDash([]);
        
        ctx.globalAlpha = isDashed ? 0.4 : 1.0;

        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(endX, y);
        ctx.stroke();
        ctx.setLineDash([]);

        ctx.beginPath();
        ctx.moveTo(endX, y);
        ctx.lineTo(endX - dir * 8, y - 6);
        ctx.lineTo(endX - dir * 8, y + 6);
        ctx.fill();

        if (label) {
            ctx.font = isDashed ? "10px sans-serif" : "bold 12px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(label, x + (dir * length)/2, y - 10);
        }
        ctx.globalAlpha = 1.0; 
    }

    function drawSim() {
        simCtx.clearRect(0, 0, simCanvas.width, simCanvas.height);
        const cy = simCanvas.height / 2;

        simCtx.strokeStyle = "#cbd5e1";
        simCtx.lineWidth = 2;
        simCtx.beginPath();
        simCtx.moveTo(0, cy + 40);
        simCtx.lineTo(simCanvas.width, cy + 40);
        simCtx.stroke();

        simCtx.fillStyle = obj1.color;
        simCtx.beginPath();
        simCtx.arc(obj1.x, cy + 40 - obj1.r, obj1.r, 0, Math.PI * 2);
        simCtx.fill();
        simCtx.fillStyle = "white";
        simCtx.font = "bold 14px sans-serif";
        simCtx.textAlign = "center";
        simCtx.fillText("mâ‚", obj1.x, cy + 45 - obj1.r);

        simCtx.fillStyle = obj2.color;
        simCtx.beginPath();
        simCtx.arc(obj2.x, cy + 40 - obj2.r, obj2.r, 0, Math.PI * 2);
        simCtx.fill();
        simCtx.fillStyle = "white";
        simCtx.fillText("mâ‚‚", obj2.x, cy + 45 - obj2.r);

        if (hasCollided) {
            drawArrow(simCtx, obj1.x, cy - 10 - obj1.r, obj1.u, obj1.color, true, "ì¶©ëŒ ì „");
            drawArrow(simCtx, obj1.x, cy - 35 - obj1.r, obj1.v, obj1.color, false, "ì¶©ëŒ í›„");
            drawArrow(simCtx, obj2.x, cy - 10 - obj2.r, obj2.u, obj2.color, true, "ì¶©ëŒ ì „");
            drawArrow(simCtx, obj2.x, cy - 35 - obj2.r, obj2.v, obj2.color, false, "ì¶©ëŒ í›„");
        } else {
            drawArrow(simCtx, obj1.x, cy - 20 - obj1.r, obj1.v, obj1.color, false, "vâ‚");
            drawArrow(simCtx, obj2.x, cy - 20 - obj2.r, obj2.v, obj2.color, false, "vâ‚‚");
        }
    }

    function drawGraph() {
        graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
        
        const w = graphCanvas.width;
        const h = graphCanvas.height;
        const padX = 40;
        const padY = 30;

        const maxTime = Math.max(200, simTime + 20); 
        const maxV = 20; 

        const toX = (t) => padX + (t / maxTime) * (w - padX * 2);
        const toY = (v) => h / 2 - (v / maxV) * (h / 2 - padY);

        graphCtx.strokeStyle = "#cbd5e1";
        graphCtx.lineWidth = 1;
        graphCtx.beginPath();
        graphCtx.moveTo(padX, h / 2); graphCtx.lineTo(w - padX, h / 2);
        graphCtx.moveTo(padX, padY); graphCtx.lineTo(padX, h - padY);
        graphCtx.stroke();

        graphCtx.fillStyle = "#64748b";
        graphCtx.font = "10px sans-serif";
        graphCtx.textAlign = "right";
        graphCtx.textBaseline = "middle";
        graphCtx.fillText("0", padX - 5, toY(0));
        graphCtx.fillText("10", padX - 5, toY(10));
        graphCtx.fillText("-10", padX - 5, toY(-10));
        graphCtx.fillText("20", padX - 5, toY(20));
        graphCtx.fillText("-20", padX - 5, toY(-20));
        
        graphCtx.textAlign = "center";
        graphCtx.textBaseline = "bottom";
        graphCtx.fillText("ì†ë„ [m/s]", padX, padY - 10);

        graphCtx.textAlign = "center";
        graphCtx.textBaseline = "top";
        const tSteps = 50; 
        for (let t = tSteps; t <= maxTime; t += tSteps) {
            const x = toX(t);
            graphCtx.beginPath();
            graphCtx.moveTo(x, h / 2 - 3);
            graphCtx.lineTo(x, h / 2 + 3);
            graphCtx.stroke();
            graphCtx.fillText(t.toString(), x, h / 2 + 5);
        }

        graphCtx.textAlign = "left";
        graphCtx.textBaseline = "middle";
        graphCtx.fillText("ì‹œê°„ [tick]", w - padX + 5, h / 2);
        
        graphCtx.textAlign = "left";
        graphCtx.textBaseline = "alphabetic";
        graphCtx.font = "bold 12px sans-serif";
        graphCtx.fillStyle = "#334155";
        graphCtx.fillText("ì‹œê°„ì— ë”°ë¥¸ ì†ë„ ë³€í™” (Velocity-Time Graph)", padX + 10, padY);
        
        graphCtx.fillStyle = "#3b82f6";
        graphCtx.fillText("â”€â”€ ë¬¼ì²´ 1 (vâ‚)", padX + 10, padY + 20);
        graphCtx.fillStyle = "#ef4444";
        graphCtx.fillText("â”€â”€ ë¬¼ì²´ 2 (vâ‚‚)", padX + 10, padY + 40);
        graphCtx.fillStyle = "#10b981";
        graphCtx.fillText("- - ìƒëŒ€ì†ë„ (vâ‚‚ - vâ‚)", padX + 10, padY + 60);

        if (historyData.length === 0) return;

        // ìƒëŒ€ì†ë„ ì„ 
        graphCtx.strokeStyle = "#10b981";
        graphCtx.lineWidth = 1.5;
        graphCtx.setLineDash([4, 4]); 
        graphCtx.beginPath();
        graphCtx.moveTo(toX(historyData[0].t), toY(historyData[0].v2 - historyData[0].v1));
        for (let i = 1; i < historyData.length; i++) {
            graphCtx.lineTo(toX(historyData[i].t), toY(historyData[i].v2 - historyData[i].v1));
        }
        graphCtx.stroke();
        graphCtx.setLineDash([]); 

        // ë¬¼ì²´ 1 ì„ 
        graphCtx.strokeStyle = "#3b82f6";
        graphCtx.lineWidth = 2;
        graphCtx.beginPath();
        graphCtx.moveTo(toX(historyData[0].t), toY(historyData[0].v1));
        for (let i = 1; i < historyData.length; i++) {
            graphCtx.lineTo(toX(historyData[i].t), toY(historyData[i].v1));
        }
        graphCtx.stroke();

        // ë¬¼ì²´ 2 ì„ 
        graphCtx.strokeStyle = "#ef4444";
        graphCtx.lineWidth = 2;
        graphCtx.beginPath();
        graphCtx.moveTo(toX(historyData[0].t), toY(historyData[0].v2));
        for (let i = 1; i < historyData.length; i++) {
            graphCtx.lineTo(toX(historyData[i].t), toY(historyData[i].v2));
        }
        graphCtx.stroke();
    }

    function loop() {
        if (isPlaying) {
            const dt = 0.5;
            obj1.x += obj1.v * dt;
            obj2.x += obj2.v * dt;
            simTime += 1;

            if (!hasCollided && (obj2.x - obj1.x <= obj1.r + obj2.r)) {
                if (obj1.v > obj2.v) {
                    const v1_final = ((obj1.m - e * obj2.m) * obj1.v + obj2.m * (1 + e) * obj2.v) / (obj1.m + obj2.m);
                    const v2_final = (obj1.m * (1 + e) * obj1.v + (obj2.m - e * obj1.m) * obj2.v) / (obj1.m + obj2.m);

                    obj1.v = v1_final;
                    obj2.v = v2_final;
                    hasCollided = true;
                    
                    dispStatus.innerHTML = `ìƒíƒœ: ì¶©ëŒ ì™„ë£Œ<br><span style="font-size:0.85rem; color:#10b981;">(ì´ ìš´ë™ëŸ‰ ë³´ì¡´ë¨)</span>`;
                    dispStatus.style.color = "#ef4444";
                }
            }

            historyData.push({ t: simTime, v1: obj1.v, v2: obj2.v });

            if (obj1.x < -100 || obj1.x > simCanvas.width + 100 || obj2.x < -100 || obj2.x > simCanvas.width + 100) {
                isPlaying = false;
                btnPlay.innerText = "ì‹œì‘ (Play)";
                btnPlay.style.background = "#10b981";
            }

            updateDashboard();
            drawSim();
            drawGraph();
            
            if (isPlaying) {
                animationId = requestAnimationFrame(loop);
            }
        }
    }

    // ì´ˆê¸°í™”
    updateSettings();
</script>

</body>
</html>
